<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tracking - Student Organizer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background-color: #f4f7f6; color: #333; }

        /* Sidebar */
        .sidebar { position: fixed; top: 0; left: -250px; width: 250px; height: 100vh; background: #2c3e50; color: white; transition: left 0.3s ease; z-index: 1000; display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #34495e; }
        .sidebar-header h2 { font-size: 1.5rem; }
        .sidebar-nav { flex: 1; list-style: none; padding: 20px 0; }
        .sidebar-nav a { display: block; padding: 15px 20px; color: #ecf0f1; text-decoration: none; transition: background-color 0.2s; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background-color: #34495e; }
        .sidebar-footer { padding: 20px; }
        .logout-btn { width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* Main Content */
        .main-content { margin-left: 0; padding: 20px; transition: margin-left 0.3s ease; }
        .main-content.shifted { margin-left: 250px; }

        /* Header */
        .header { display: flex; align-items: center; margin-bottom: 30px; background: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .menu-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; margin-right: 20px; padding: 5px; }

        /* AI Banner */
        .ai-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 40px; border-radius: 15px; margin-bottom: 30px; position: relative; overflow: hidden;
        }
        .ai-banner::before {
            content: ''; position: absolute; top: -50%; right: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.3; } }
        .banner-content { position: relative; z-index: 1; text-align: center; }
        .banner-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .ai-indicator { display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: #2ecc71; animation: pulse-indicator 2s infinite; margin-left: 10px; }
        @keyframes pulse-indicator { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .banner-subtitle { font-size: 1.1rem; opacity: 0.9; margin-bottom: 20px; }
        .banner-stats { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin-top: 30px; }
        .banner-stat { text-align: center; }
        .banner-stat-value { font-size: 2rem; font-weight: 700; display: block; }
        .banner-stat-label { font-size: 0.9rem; opacity: 0.85; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px; transition: transform 0.3s ease; }
        .stat-card:hover { transform: translateY(-2px); }
        .stat-icon { font-size: 2.5rem; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .stat-icon.primary { background: rgba(52, 152, 219, 0.1); color: #3498db; }
        .stat-icon.success { background: rgba(46, 204, 113, 0.1); color: #2ecc71; }
        .stat-icon.warning { background: rgba(243, 156, 18, 0.1); color: #f39c12; }
        .stat-icon.danger { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
        .stat-info h3 { font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px; }
        .stat-info p { font-size: 1.8rem; font-weight: bold; color: #2c3e50; }

        /* AI Features */
        .ai-features { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .section-title { color: #2c3e50; font-size: 1.5rem; font-weight: 600; }
        .btn { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s; }
        .btn:hover { background: #2980b9; }
        .btn-sm { padding: 8px 16px; font-size: 12px; }
        .btn-success { background: #2ecc71; }
        .btn-success:hover { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }

        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .feature-card { border: 2px solid #ecf0f1; border-radius: 12px; padding: 25px; transition: all 0.3s ease; }
        .feature-card:hover { border-color: #3498db; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .feature-icon { font-size: 2.5rem; margin-bottom: 15px; }
        .feature-title { font-size: 1.2rem; color: #2c3e50; margin-bottom: 10px; font-weight: 600; }
        .feature-description { color: #7f8c8d; line-height: 1.5; margin-bottom: 15px; }
        .feature-status { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
        .status-badge.active { background: rgba(46, 204, 113, 0.1); color: #2ecc71; }
        .status-badge.learning { background: rgba(52, 152, 219, 0.1); color: #3498db; }

        /* Recommendations */
        .recommendations-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .recommendation-item { border-left: 4px solid #3498db; padding: 20px; background: #f8f9fa; margin-bottom: 15px; border-radius: 0 8px 8px 0; }
        .recommendation-item.urgent { border-left-color: #e74c3c; }
        .recommendation-item.high-priority { border-left-color: #f39c12; }
        .recommendation-item.suggestion { border-left-color: #2ecc71; }
        .recommendation-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .recommendation-title { font-weight: 600; color: #2c3e50; }
        .recommendation-priority { padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 500; }
        .priority-urgent { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
        .priority-high { background: rgba(243, 156, 18, 0.1); color: #f39c12; }
        .priority-normal { background: rgba(52, 152, 219, 0.1); color: #3498db; }
        .recommendation-description { color: #7f8c8d; line-height: 1.5; margin-bottom: 10px; }

        /* Chat Interface */
        .chat-interface { background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .chat-header { background: #3498db; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .chat-title { font-size: 1.2rem; font-weight: 600; }
        .chat-messages { max-height: 400px; overflow-y: auto; padding: 20px; background: #f8f9fa; }
        .message { margin-bottom: 15px; display: flex; align-items: flex-start; gap: 10px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { flex-direction: row-reverse; }
        .message-avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.8rem; flex-shrink: 0; }
        .message-avatar.ai { background: #3498db; color: white; }
        .message-avatar.user { background: #2c3e50; color: white; }
        .message-bubble { max-width: 70%; padding: 12px 16px; border-radius: 18px; line-height: 1.4; }
        .message.user .message-bubble { background: #3498db; color: white; border-radius: 18px 18px 0 18px; }
        .message.ai .message-bubble { background: white; border: 1px solid #ecf0f1; color: #2c3e50; border-radius: 18px 18px 18px 0; }
        .chat-input { padding: 20px; background: white; border-top: 1px solid #ecf0f1; display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 12px 16px; border: 2px solid #ecf0f1; border-radius: 25px; outline: none; font-family: inherit; }
        .chat-input input:focus { border-color: #3498db; }
        .chat-send { padding: 12px 20px; background: #3498db; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; }
        .chat-send:hover { background: #2980b9; }

        /* Overlay */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .overlay.active { opacity: 1; visibility: visible; }

        /* Notifications */
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: #2ecc71; color: white; border-radius: 8px; z-index: 10000; animation: slideIn 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content.shifted { margin-left: 0; }
            .banner-stats { flex-direction: column; }
            .features-grid { grid-template-columns: 1fr; }
            .message-bubble { max-width: 85%; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üìö Student Hub</h2>
        </div>
        <nav>
            <ul class="sidebar-nav">
                <li><a href="dashboard.html">üè† Dashboard</a></li>
                <li><a href="profile.html">üë§ Profile</a></li>
                <li><a href="goals.html">üéØ Goals</a></li>
                <li><a href="calendar.html">üìÖ Calendar</a></li>
                <li><a href="history.html">üìú History</a></li>
                <li><a href="analysis.html">üìä Analysis</a></li>
                <li><a href="ai-tracking.html" class="active">ü§ñ AI Tracking</a></li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <div class="main-content" id="main-content">
        <!-- Header -->
        <div class="header">
            <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
            <h1>AI Learning Assistant</h1>
        </div>

        <!-- AI Banner -->
        <div class="ai-banner">
            <div class="banner-content">
                <h2 class="banner-title">AI Assistant <span class="ai-indicator" id="ai-indicator"></span></h2>
                <p class="banner-subtitle" id="ai-status-text">Your personal AI is actively learning from your patterns</p>
                <button class="btn" id="toggle-ai-btn" onclick="toggleAI()">Pause AI Tracking</button>
                
                <div class="banner-stats">
                    <div class="banner-stat">
                        <span class="banner-stat-value" id="days-learning">0</span>
                        <span class="banner-stat-label">Days Learning</span>
                    </div>
                    <div class="banner-stat">
                        <span class="banner-stat-value" id="patterns-found">0</span>
                        <span class="banner-stat-label">Patterns Found</span>
                    </div>
                    <div class="banner-stat">
                        <span class="banner-stat-value" id="recommendations-given">0</span>
                        <span class="banner-stat-label">Recommendations</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary">üß†</div>
                <div class="stat-info">
                    <h3>AI Accuracy</h3>
                    <p id="ai-accuracy">85%</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success">‚úÖ</div>
                <div class="stat-info">
                    <h3>Applied Suggestions</h3>
                    <p id="applied-suggestions">12</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning">üìà</div>
                <div class="stat-info">
                    <h3>Productivity Gain</h3>
                    <p id="productivity-gain">+23%</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon danger">‚ö°</div>
                <div class="stat-info">
                    <h3>Wellness Score</h3>
                    <p id="wellness-score">78/100</p>
                </div>
            </div>
        </div>

        <!-- AI Features Section -->
        <div class="ai-features">
            <div class="section-header">
                <h2 class="section-title">AI Capabilities</h2>
                <button class="btn btn-sm" onclick="refreshAnalysis()">Refresh Analysis</button>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üß†</div>
                    <h3 class="feature-title">Pattern Recognition</h3>
                    <p class="feature-description">Analyzes your study habits, sleep patterns, and productivity to identify what works best for you.</p>
                    <div class="feature-status">
                        <span class="status-badge active">Active</span>
                        <span id="pattern-days">Learning for 5 days</span>
                    </div>
                    <button class="btn btn-sm" onclick="showPatternAnalysis()">View Analysis</button>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3 class="feature-title">Smart Scheduling</h3>
                    <p class="feature-description">Suggests optimal study times and break intervals based on your energy levels and performance data.</p>
                    <div class="feature-status">
                        <span class="status-badge learning">Learning</span>
                        <span>Collecting data</span>
                    </div>
                    <button class="btn btn-sm" onclick="showSchedule()">Get Suggestions</button>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3 class="feature-title">Goal Optimization</h3>
                    <p class="feature-description">Continuously adjusts your goals based on progress and provides realistic timelines.</p>
                    <div class="feature-status">
                        <span class="status-badge active">Active</span>
                        <span id="optimized-goals">3 goals optimized</span>
                    </div>
                    <button class="btn btn-sm" onclick="showGoalOptimization()">View Goals</button>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚ö†Ô∏è</div>
                    <h3 class="feature-title">Wellness Alerts</h3>
                    <p class="feature-description">Detects signs of burnout, poor sleep, or stress and suggests healthy interventions.</p>
                    <div class="feature-status">
                        <span class="status-badge active">Active</span>
                        <span>Monitoring 24/7</span>
                    </div>
                    <button class="btn btn-sm" onclick="showWellnessCheck()">Wellness Status</button>
                </div>
            </div>
        </div>

        <!-- AI Recommendations Section -->
        <div class="recommendations-section">
            <div class="section-header">
                <h2 class="section-title">Today's AI Recommendations</h2>
                <button class="btn btn-sm btn-success" onclick="refreshRecommendations()">Refresh</button>
            </div>
            <div id="recommendations-list">
                <!-- Recommendations will be loaded here -->
            </div>
        </div>

        <!-- AI Chat Interface -->
        <div class="chat-interface">
            <div class="chat-header">
                <div class="chat-title">üí¨ Chat with Your AI Assistant</div>
                <span class="ai-indicator"></span>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    <div class="message-avatar ai">AI</div>
                    <div class="message-bubble">
                        Hello! I'm your personal AI learning assistant. I can help you optimize your study habits, suggest break times, and answer questions about your progress. How can I assist you today?
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Ask me anything about your study habits..." onkeypress="handleChatKeypress(event)">
                <button class="chat-send" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "ENTER YOUR API KEY",
            authDomain: "student-organizer-53420.firebaseapp.com",
            projectId: "student-organizer-53420",
            storageBucket: "student-organizer-53420.firebasestorage.app",
            messagingSenderId: "481845921136",
            appId: "1:481845921136:web:10ce801027f42b2311bbb5",
            measurementId: "G-7365W6G880"
        };

        let auth, db;
        let currentUser = null;
        let aiActive = true;

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (error) {
            console.error('Firebase init error:', error);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    initializeDashboard();
                } else {
                    window.location.href = 'index.html';
                }
            });
        });

        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const content = document.getElementById('main-content');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            content.classList.toggle('shifted');
        }

        document.getElementById('overlay').addEventListener('click', toggleMenu);

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await auth.signOut();
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Error logging out. Please try again.');
                }
            }
        }

        async function initializeDashboard() {
            await loadAIStatistics();
            await loadRecommendations();
            startRealTimeUpdates();
        }

        async function loadAIStatistics() {
            if (!currentUser) return;

            try {
                const aiSettingsRef = db.collection('users').doc(currentUser.uid).collection('aiSettings').doc('config');
                const aiDoc = await aiSettingsRef.get();
                
                let daysLearning = 0;
                if (aiDoc.exists && aiDoc.data().startDate) {
                    const startDate = aiDoc.data().startDate.toDate();
                    const now = new Date();
                    daysLearning = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
                } else {
                    await aiSettingsRef.set({
                        startDate: firebase.firestore.FieldValue.serverTimestamp(),
                        active: true,
                        patternsFound: 0,
                        recommendationsGiven: 0
                    });
                }

                const analytics = await analyzeUserPatterns();
                
                document.getElementById('days-learning').textContent = daysLearning;
                document.getElementById('patterns-found').textContent = analytics.patternsFound;
                document.getElementById('recommendations-given').textContent = analytics.recommendationsGiven;
                document.getElementById('ai-accuracy').textContent = analytics.accuracy + '%';
                document.getElementById('applied-suggestions').textContent = analytics.appliedSuggestions;
                document.getElementById('productivity-gain').textContent = '+' + analytics.productivityGain + '%';
                document.getElementById('wellness-score').textContent = analytics.wellnessScore + '/100';

            } catch (error) {
                console.error('Error loading AI statistics:', error);
            }
        }

        async function analyzeUserPatterns() {
            if (!currentUser) return getDefaultAnalytics();

            let totalStudy = 0;
            let totalSleep = 0;
            let studyDays = 0;
            let sleepDays = 0;
            let patternsFound = 0;

            try {
                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const docRef = db.collection('users').doc(currentUser.uid).collection('dailyData').doc(dateStr);
                    const doc = await docRef.get();
                    
                    if (doc.exists) {
                        const data = doc.data();
                        if (data.trackers) {
                            if (data.trackers.study) {
                                totalStudy += parseFloat(data.trackers.study);
                                studyDays++;
                            }
                            if (data.trackers.sleep) {
                                totalSleep += parseFloat(data.trackers.sleep);
                                sleepDays++;
                            }
                        }
                    }
                }

                const avgStudy = studyDays > 0 ? totalStudy / studyDays : 0;
                const avgSleep = sleepDays > 0 ? totalSleep / sleepDays : 0;
                
                if (studyDays >= 3) patternsFound++;
                if (sleepDays >= 3) patternsFound++;
                if (avgStudy > 4) patternsFound++;
                if (avgSleep >= 7) patternsFound++;

                const wellnessScore = Math.round(
                    (avgSleep >= 7 ? 25 : (avgSleep / 7) * 25) +
                    (avgStudy >= 5 ? 25 : (avgStudy / 5) * 25) +
                    (studyDays >= 5 ? 25 : (studyDays / 5) * 25) +
                    25
                );

                return {
                    studyHours: avgStudy.toFixed(1),
                    sleepHours: avgSleep.toFixed(1),
                    patternsFound: patternsFound,
                    recommendationsGiven: Math.min(15, patternsFound * 3),
                    accuracy: Math.min(95, 70 + (patternsFound * 5)),
                    appliedSuggestions: Math.floor(patternsFound * 2.5),
                    productivityGain: Math.min(35, patternsFound * 5),
                    wellnessScore: wellnessScore,
                    studyDays: studyDays
                };
            } catch (error) {
                console.error('Error analyzing patterns:', error);
                return getDefaultAnalytics();
            }
        }

        function getDefaultAnalytics() {
            return {
                studyHours: '0.0',
                sleepHours: '0.0',
                patternsFound: 0,
                recommendationsGiven: 0,
                accuracy: 70,
                appliedSuggestions: 0,
                productivityGain: 0,
                wellnessScore: 50,
                studyDays: 0
            };
        }

        async function loadRecommendations() {
            const analytics = await analyzeUserPatterns();
            const recommendations = generateRecommendations(analytics);
            
            const recommendationsList = document.getElementById('recommendations-list');
            
            if (recommendations.length === 0) {
                recommendationsList.innerHTML = `
                    <div class="recommendation-item suggestion">
                        <div class="recommendation-header">
                            <span class="recommendation-title">üéâ All Good!</span>
                            <span class="recommendation-priority priority-normal">Info</span>
                        </div>
                        <div class="recommendation-description">
                            You're doing great! Keep tracking your activities to help the AI provide personalized insights.
                        </div>
                    </div>
                `;
                return;
            }
            
            recommendationsList.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item ${rec.priority}">
                    <div class="recommendation-header">
                        <span class="recommendation-title">${rec.title}</span>
                        <span class="recommendation-priority priority-${rec.priorityClass}">${rec.priorityLabel}</span>
                    </div>
                    <div class="recommendation-description">${rec.description}</div>
                    ${rec.action ? `<button class="btn btn-sm" onclick="${rec.action.onclick}">${rec.action.label}</button>` : ''}
                </div>
            `).join('');
        }

        function generateRecommendations(analytics) {
            const recommendations = [];
            
            if (analytics.studyDays < 3) {
                recommendations.push({
                    priority: 'high-priority',
                    priorityClass: 'high',
                    priorityLabel: 'High',
                    title: 'üìö Start Tracking Study Time',
                    description: 'Begin logging your study hours daily to help the AI understand your learning patterns and provide personalized recommendations.',
                    action: { label: 'Log Now', onclick: 'goToDashboard()' }
                });
            } else if (parseFloat(analytics.studyHours) < 4) {
                recommendations.push({
                    priority: 'high-priority',
                    priorityClass: 'high',
                    priorityLabel: 'High',
                    title: 'üìö Increase Study Time',
                    description: `Your average study time is ${analytics.studyHours} hours/day. Consider gradually increasing to 5-6 hours for better academic performance.`,
                    action: { label: 'Set Goal', onclick: 'setStudyGoal()' }
                });
            } else if (parseFloat(analytics.studyHours) > 8) {
                recommendations.push({
                    priority: 'urgent',
                    priorityClass: 'urgent',
                    priorityLabel: 'Urgent',
                    title: '‚ö†Ô∏è Take a Break!',
                    description: `You're studying ${analytics.studyHours} hours/day on average. This may lead to burnout. Consider taking more breaks and balancing your schedule.`,
                    action: { label: 'Schedule Break', onclick: 'scheduleBreak()' }
                });
            }
            
            if (parseFloat(analytics.sleepHours) < 6) {
                recommendations.push({
                    priority: 'urgent',
                    priorityClass: 'urgent',
                    priorityLabel: 'Urgent',
                    title: 'üò¥ Prioritize Sleep',
                    description: `You're averaging ${analytics.sleepHours} hours of sleep. This significantly impacts memory and learning. Aim for 7-8 hours for optimal cognitive function.`,
                    action: { label: 'Set Sleep Goal', onclick: 'setSleepGoal()' }
                });
            } else if (parseFloat(analytics.sleepHours) < 7) {
                recommendations.push({
                    priority: 'high-priority',
                    priorityClass: 'high',
                    priorityLabel: 'High',
                    title: 'üåô Improve Sleep Quality',
                    description: `Current average: ${analytics.sleepHours} hours. Try to increase to 7-8 hours for better memory consolidation and focus.`,
                    action: { label: 'Sleep Tips', onclick: 'showSleepTips()' }
                });
            } else if (parseFloat(analytics.sleepHours) > 9) {
                recommendations.push({
                    priority: 'suggestion',
                    priorityClass: 'normal',
                    priorityLabel: 'Suggestion',
                    title: '‚è∞ Optimize Sleep Schedule',
                    description: `You're sleeping ${analytics.sleepHours} hours on average. While sleep is important, too much can reduce alertness. Consider adjusting to 7-8 hours.`,
                    action: null
                });
            }
            
            if (parseFloat(analytics.studyHours) >= 5 && parseFloat(analytics.sleepHours) >= 7) {
                recommendations.push({
                    priority: 'suggestion',
                    priorityClass: 'normal',
                    priorityLabel: 'Suggestion',
                    title: 'üéØ Great Balance!',
                    description: 'Your study-life balance looks excellent! The AI has identified your most productive hours are likely 9-11 AM. Schedule difficult tasks during this time.',
                    action: { label: 'View Schedule', onclick: 'showSchedule()' }
                });
            }
            
            if (analytics.wellnessScore < 60) {
                recommendations.push({
                    priority: 'high-priority',
                    priorityClass: 'high',
                    priorityLabel: 'High',
                    title: 'üí™ Focus on Wellness',
                    description: `Your wellness score is ${analytics.wellnessScore}/100. Consider incorporating exercise, regular breaks, and stress management techniques.`,
                    action: { label: 'Wellness Check', onclick: 'showWellnessCheck()' }
                });
            }
            
            if (analytics.wellnessScore >= 70 && recommendations.length < 3) {
                recommendations.push({
                    priority: 'suggestion',
                    priorityClass: 'normal',
                    priorityLabel: 'Achievement',
                    title: 'üéâ Excellent Progress!',
                    description: 'Keep up the great work! Your consistency is improving and you\'re on track to meet your goals. The AI is learning more about your optimal study patterns.',
                    action: { label: 'View Analytics', onclick: 'showPatternAnalysis()' }
                });
            }
            
            return recommendations.slice(0, 4);
        }

        async function refreshRecommendations() {
            await loadRecommendations();
            showNotification('Recommendations updated!', 'success');
        }

        async function refreshAnalysis() {
            await loadAIStatistics();
            await loadRecommendations();
            showNotification('AI analysis refreshed!', 'success');
        }

        function toggleAI() {
            aiActive = !aiActive;
            const btn = document.getElementById('toggle-ai-btn');
            const statusText = document.getElementById('ai-status-text');
            
            if (aiActive) {
                btn.textContent = 'Pause AI Tracking';
                btn.className = 'btn';
                statusText.textContent = 'Your personal AI is actively learning from your patterns';
                showNotification('AI tracking resumed', 'success');
            } else {
                btn.textContent = 'Resume AI Tracking';
                btn.className = 'btn btn-danger';
                statusText.textContent = 'AI tracking is currently paused';
                showNotification('AI tracking paused', 'info');
            }
            
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).collection('aiSettings').doc('config')
                    .update({ active: aiActive }).catch(err => console.error('Error updating AI status:', err));
            }
        }

        async function showPatternAnalysis() {
            const analytics = await analyzeUserPatterns();
            const message = `Based on your data:\n\n‚Ä¢ Average study time: ${analytics.studyHours} hours/day\n‚Ä¢ Average sleep: ${analytics.sleepHours} hours/night\n‚Ä¢ Days tracked: ${analytics.studyDays}\n‚Ä¢ Wellness Score: ${analytics.wellnessScore}/100\n‚Ä¢ Patterns identified: ${analytics.patternsFound}\n\nMost productive time: 9-11 AM\nRecommended break frequency: Every 45-50 minutes`;
            alert(message);
        }

        function showSchedule() {
            const suggestions = [
                "üåÖ Morning (6-9 AM): Best for math and analytical subjects",
                "‚òÄÔ∏è Late Morning (9-12 PM): Optimal for complex reading and writing",
                "üå§Ô∏è Afternoon (12-5 PM): Great for group work and discussions",
                "üåÜ Evening (5-8 PM): Perfect for review and light tasks",
                "üåô Night (8-10 PM): Ideal for reading and memorization"
            ];
            
            alert("AI-Recommended Study Schedule:\n\n" + suggestions.join("\n\n"));
        }

        async function showGoalOptimization() {
            const analytics = await analyzeUserPatterns();
            let suggestions = "Goal Optimization:\n\n";
            
            if (parseFloat(analytics.studyHours) > 0) {
                suggestions += `‚Ä¢ Study Goal: Currently ${analytics.studyHours}h/day\n`;
                if (parseFloat(analytics.studyHours) < 5) {
                    suggestions += "  ‚Üí Increase to 5-6h for optimal learning\n\n";
                } else if (parseFloat(analytics.studyHours) > 8) {
                    suggestions += "  ‚Üí Reduce to 6-7h to prevent burnout\n\n";
                } else {
                    suggestions += "  ‚Üí On track! ‚úÖ\n\n";
                }
            }
            
            if (parseFloat(analytics.sleepHours) > 0) {
                suggestions += `‚Ä¢ Sleep Goal: Currently ${analytics.sleepHours}h/night\n`;
                if (parseFloat(analytics.sleepHours) < 7) {
                    suggestions += "  ‚Üí Increase to 7-8h for better focus\n\n";
                } else if (parseFloat(analytics.sleepHours) > 9) {
                    suggestions += "  ‚Üí Consider reducing to 7-8h\n\n";
                } else {
                    suggestions += "  ‚Üí Perfect! ‚úÖ\n\n";
                }
            }
            
            suggestions += "‚Ä¢ Exercise Goal: 30-45min/day for better focus\n‚Ä¢ Break Goal: 15min every 45-50min of study";
            
            alert(suggestions);
        }

        async function showWellnessCheck() {
            const analytics = await analyzeUserPatterns();
            let status = "Excellent";
            
            if (analytics.wellnessScore < 50) {
                status = "Needs Attention";
            } else if (analytics.wellnessScore < 70) {
                status = "Good";
            } else if (analytics.wellnessScore < 85) {
                status = "Very Good";
            }
            
            const message = `Wellness Status: ${status}\n\n‚Ä¢ Overall Score: ${analytics.wellnessScore}/100\n‚Ä¢ Sleep Quality: ${analytics.sleepHours}h (${parseFloat(analytics.sleepHours) >= 7 ? 'Good' : 'Needs Improvement'})\n‚Ä¢ Study Consistency: ${analytics.studyDays}/7 days\n‚Ä¢ Stress Level: ${analytics.wellnessScore >= 70 ? 'Low' : 'Moderate'}\n‚Ä¢ Energy Level: ${analytics.wellnessScore >= 70 ? 'High' : 'Moderate'}\n\nRecommendation: ${status === 'Needs Attention' ? 'Focus on sleep and breaks' : 'Maintain current routine'}`;
            
            alert(message);
        }

        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }

        function setStudyGoal() {
            const goal = prompt('Set your daily study goal (hours):', '5');
            if (goal && !isNaN(goal)) {
                showNotification(`Study goal set to ${goal} hours! üìö`, 'success');
            }
        }

        function setSleepGoal() {
            const goal = prompt('Set your sleep goal (hours):', '8');
            if (goal && !isNaN(goal)) {
                showNotification(`Sleep goal set to ${goal} hours! üò¥`, 'success');
            }
        }

        function scheduleBreak() {
            showNotification('Break scheduled! Take 15 minutes ‚òï', 'success');
        }

        function showSleepTips() {
            const tips = "Sleep Improvement Tips:\n\n‚úì Maintain consistent sleep schedule\n‚úì Avoid screens 1 hour before bed\n‚úì Keep room cool and dark\n‚úì Avoid caffeine after 4 PM\n‚úì Exercise regularly (but not before bed)\n‚úì Create a relaxing bedtime routine";
            alert(tips);
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = generateAIResponse(message);
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function addChatMessage(message, sender) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `
                <div class="message-avatar ${sender}">${sender === 'ai' ? 'AI' : 'You'}</div>
                <div class="message-bubble">${message}</div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('study') || lowerMessage.includes('learn')) {
                return "Based on your patterns, you're most productive in the morning. I recommend studying your most difficult subjects between 9-11 AM when your focus is highest. Would you like me to suggest a study schedule?";
            } else if (lowerMessage.includes('sleep') || lowerMessage.includes('tired')) {
                return "I notice your sleep patterns could be optimized. For optimal cognitive function, aim for 7-8 hours of consistent sleep. Try setting a regular bedtime and avoiding screens 1 hour before sleep. Would you like sleep improvement tips?";
            } else if (lowerMessage.includes('break') || lowerMessage.includes('rest')) {
                return "Great question! Based on research and your activity patterns, I recommend the Pomodoro technique: 25 minutes of focused study, followed by a 5-minute break. After 4 cycles, take a longer 15-30 minute break. This helps maintain focus and prevents burnout.";
            } else if (lowerMessage.includes('goal') || lowerMessage.includes('progress')) {
                return "You're making excellent progress! Your consistency has improved significantly. The AI has identified that you perform best with regular routines. Keep tracking your activities to help me provide even better personalized insights.";
            } else if (lowerMessage.includes('stressed') || lowerMessage.includes('overwhelmed')) {
                return "I understand you might be feeling overwhelmed. Here's what I suggest: 1) Take a 15-minute break now, 2) Break large tasks into smaller ones, 3) Prioritize your most important task, 4) Practice deep breathing. Remember, it's okay to ask for help. Would you like me to suggest some stress-relief techniques?";
            } else if (lowerMessage.includes('productive') || lowerMessage.includes('focus')) {
                return "To maximize productivity: 1) Study during your peak hours (9-11 AM), 2) Eliminate distractions, 3) Use the Pomodoro technique, 4) Get adequate sleep (7-8 hours), 5) Take regular breaks. Your data shows you're most focused after a good night's sleep!";
            } else if (lowerMessage.includes('exercise') || lowerMessage.includes('workout')) {
                return "Exercise significantly improves focus and memory! I recommend 30-45 minutes of moderate exercise daily, preferably in the morning or afternoon (not close to bedtime). Even a 10-minute walk can boost your cognitive performance.";
            } else {
                return "I'm here to help optimize your learning experience! I can provide insights about your study patterns, suggest optimal schedules, help with goal setting, or answer questions about productivity and wellness. What specific area would you like to focus on?";
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            if (type === 'success') {
                notification.style.background = '#2ecc71';
            } else if (type === 'info') {
                notification.style.background = '#3498db';
            } else if (type === 'error') {
                notification.style.background = '#e74c3c';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function startRealTimeUpdates() {
            setInterval(async () => {
                if (aiActive) {
                    await loadAIStatistics();
                }
            }, 300000);
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('active')) {
                    toggleMenu();
                }
            }
        });
    </script>
</body>
<link rel="stylesheet" href="y2k-style.css">

</html>
