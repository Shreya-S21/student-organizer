<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Organizer - Login</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .card{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);width:100%;max-width:420px;overflow:hidden}
        .card-header{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:30px;text-align:center}
        .card-header h1{font-size:1.6rem;margin-bottom:5px}
        .card-header p{opacity:0.8;font-size:0.9rem}
        .card-body{padding:25px}
        .status-bar{padding:10px 15px;border-radius:8px;margin-bottom:15px;font-size:0.8rem;text-align:center}
        .status-loading{background:#fff3cd;color:#856404}
        .status-connected{background:#d4edda;color:#155724}
        .status-error{background:#f8d7da;color:#721c24}
        .tabs{display:flex;margin-bottom:20px;background:#f0f0f0;border-radius:10px;padding:4px}
        .tabs button{flex:1;padding:12px;border:none;background:none;font-size:0.95rem;font-weight:600;color:#666;cursor:pointer;border-radius:8px;font-family:inherit;transition:0.3s}
        .tabs button.active{background:#fff;color:#667eea;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
        .form-box{display:none}
        .form-box.active{display:block}
        .input-group{margin-bottom:18px}
        .input-group label{display:block;margin-bottom:5px;font-weight:500;color:#333;font-size:0.9rem}
        .input-group input{width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;font-family:inherit;transition:0.3s}
        .input-group input:focus{outline:none;border-color:#667eea}
        .btn{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;font-family:inherit;transition:0.3s;margin-top:10px}
        .btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 5px 20px rgba(102,126,234,0.4)}
        .btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
        .btn-logout{background:#f0f0f0;color:#666;margin-top:10px}
        .btn-logout:hover:not(:disabled){background:#e0e0e0;box-shadow:none;transform:none}
        .btn-google{background:#fff;color:#333;border:2px solid #ddd;margin-top:15px;display:flex;align-items:center;justify-content:center;gap:10px}
        .btn-google:hover:not(:disabled){background:#f5f5f5;transform:none;box-shadow:none}
        .divider{text-align:center;margin:20px 0;color:#999;font-size:0.85rem;position:relative}
        .divider::before,.divider::after{content:'';position:absolute;top:50%;width:40%;height:1px;background:#ddd}
        .divider::before{left:0}
        .divider::after{right:0}
        .msg{padding:12px;border-radius:8px;margin-bottom:15px;font-size:0.9rem;display:none}
        .msg-error{background:#ffe0e0;color:#d32f2f;border:1px solid #ffcdd2}
        .msg-success{background:#e0ffe0;color:#2e7d32;border:1px solid #c8e6c9}
        .welcome-box{text-align:center;padding:20px 0}
        .welcome-box h2{color:#333;margin-bottom:10px}
        .welcome-box p{color:#666;margin-bottom:5px}
        .welcome-box .email{font-size:0.85rem;color:#888;margin-bottom:20px}
        .avatar{width:80px;height:80px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;font-size:2rem;color:#fff}
        .avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover}
    </style>
</head>
<body>
    <div class="card">
        <div class="card-header">
            <h1>üìö Student Organizer</h1>
            <p>AI-Powered Productivity Optimizer</p>
        </div>
        <div class="card-body">
            <div class="status-bar status-loading" id="statusBar">‚è≥ Connecting to Firebase...</div>

            <div id="authSection">
                <div class="tabs">
                    <button id="tabSignin" class="active" onclick="switchTab('signin')">Sign In</button>
                    <button id="tabSignup" onclick="switchTab('signup')">Sign Up</button>
                </div>
                
                <div class="msg msg-error" id="errorMsg"></div>
                <div class="msg msg-success" id="successMsg"></div>

                <div class="form-box active" id="signinForm">
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email">
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn" id="loginBtn" onclick="handleLogin()">Sign In</button>
                    <div class="divider">or</div>
                    <button class="btn btn-google" id="googleBtn" onclick="handleGoogleLogin()">
                        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Continue with Google
                    </button>
                </div>

                <div class="form-box" id="signupForm">
                    <div class="input-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your name">
                    </div>
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="Enter your email">
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="Min 6 characters">
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirm" placeholder="Confirm password">
                    </div>
                    <button class="btn" id="registerBtn" onclick="handleRegister()">Create Account</button>
                    <div class="divider">or</div>
                    <button class="btn btn-google" onclick="handleGoogleLogin()">
                        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Sign up with Google
                    </button>
                </div>
            </div>

            <div id="welcomeSection" style="display:none">
                <div class="welcome-box">
                    <div class="avatar" id="userAvatar">üë§</div>
                    <h2 id="welcomeName">Welcome!</h2>
                    <p class="email" id="welcomeEmail"></p>
                    <button class="btn" onclick="goToDashboard()">Go to Dashboard</button>
                    <button class="btn btn-logout" onclick="handleLogout()">Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
    const firebaseConfig = {
        apiKey: "AQ.Ab8RN6LPHpdgPJgRT_yrerlzNIs4P7kbLElOWFPGI961WBSIZw",
        authDomain: "student-organizer-53420.firebaseapp.com",
        projectId: "student-organizer-53420",
        storageBucket: "student-organizer-53420.appspot.com", /* FIXED LINE */
        messagingSenderId: "481845921136",
        appId: "1:481845921136:web:10ce801027f42b2311bbb5",
        measurementId: "G-7365W6G880"
    };

    let auth, db, googleProvider;
    let firebaseReady = false;

    try {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        googleProvider = new firebase.auth.GoogleAuthProvider();
        
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(() => {
                firebaseReady = true;
                updateStatus('connected', '‚úÖ Firebase Connected');
            })
            .catch((error) => {
                updateStatus('error', '‚ö†Ô∏è ' + error.message);
            });
    } catch (error) {
        updateStatus('error', '‚ùå Firebase Error: ' + error.message);
    }

    function updateStatus(type, message) {
        const bar = document.getElementById('statusBar');
        bar.className = 'status-bar status-' + type;
        bar.textContent = message;
    }

    function showError(msg) {
        document.getElementById('errorMsg').textContent = msg;
        document.getElementById('errorMsg').style.display = 'block';
        document.getElementById('successMsg').style.display = 'none';
    }

    function showSuccess(msg) {
        document.getElementById('successMsg').textContent = msg;
        document.getElementById('successMsg').style.display = 'block';
        document.getElementById('errorMsg').style.display = 'none';
    }

    function hideMessages() {
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('successMsg').style.display = 'none';
    }

    function switchTab(tab) {
        hideMessages();
        document.getElementById('tabSignin').classList.toggle('active', tab === 'signin');
        document.getElementById('tabSignup').classList.toggle('active', tab === 'signup');
        document.getElementById('signinForm').classList.toggle('active', tab === 'signin');
        document.getElementById('signupForm').classList.toggle('active', tab === 'signup');
    }

    function setButtonLoading(btnId, loading, text) {
        const btn = document.getElementById(btnId);
        btn.disabled = loading;
        btn.textContent = text;
    }

    function getErrorMessage(code) {
        const errors = {
            'auth/invalid-email': 'Invalid email address.',
            'auth/user-disabled': 'This account has been disabled.',
            'auth/user-not-found': 'No account found. Please sign up first.',
            'auth/wrong-password': 'Incorrect password.',
            'auth/email-already-in-use': 'Email already registered. Please sign in.',
            'auth/weak-password': 'Password must be at least 6 characters.',
            'auth/invalid-credential': 'Invalid email or password.',
            'auth/too-many-requests': 'Too many attempts. Try later.',
            'auth/network-request-failed': 'Network error.',
            'auth/popup-closed-by-user': 'Popup was closed.',
            'auth/operation-not-allowed': 'Google sign-in not enabled.'
        };
        return errors[code] || 'Error: ' + code;
    }

    function showAuthSection() {
        document.getElementById('authSection').style.display = 'block';
        document.getElementById('welcomeSection').style.display = 'none';
    }

    function showWelcomeSection(user) {
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('welcomeSection').style.display = 'block';
        
        const name = user.displayName || 'User';
        document.getElementById('welcomeName').textContent = 'Welcome, ' + name + '!';
        document.getElementById('welcomeEmail').textContent = user.email;
        
        const avatar = document.getElementById('userAvatar');
        if (user.photoURL) {
            avatar.innerHTML = '<img src="' + user.photoURL + '">';
        } else {
            avatar.innerHTML = 'üë§';
        }
    }

    async function handleRegister() {
        hideMessages();

        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        const confirm = document.getElementById('regConfirm').value;

        if (!name || !email || !password || !confirm) return showError('Fill all fields.');
        if (password.length < 6) return showError('Password too short.');
        if (password !== confirm) return showError('Passwords do not match.');

        setButtonLoading('registerBtn', true, 'Creating...');

        try {
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            await userCredential.user.updateProfile({ displayName: name });

            await db.collection('users').doc(userCredential.user.uid).set({
                name,
                email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            showSuccess('Account created!');
        } catch (error) {
            showError(getErrorMessage(error.code));
        }

        setButtonLoading('registerBtn', false, 'Create Account');
    }

    async function handleLogin() {
        hideMessages();

        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;

        if (!email || !password) return showError('Fill all fields.');

        setButtonLoading('loginBtn', true, 'Signing in...');

        try {
            await auth.signInWithEmailAndPassword(email, password);
            showSuccess('Login successful!');
        } catch (error) {
            showError(getErrorMessage(error.code));
        }

        setButtonLoading('loginBtn', false, 'Sign In');
    }

    async function handleGoogleLogin() {
        hideMessages();
        if (!firebaseReady) return showError('Firebase not ready.');

        try {
            const result = await auth.signInWithPopup(googleProvider);
            const user = result.user;

            const userDoc = await db.collection('users').doc(user.uid).get();
            if (!userDoc.exists) {
                await db.collection('users').doc(user.uid).set({
                    name: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }

            showSuccess('Google sign-in successful!');
        } catch (error) {
            if (error.code !== 'auth/popup-closed-by-user') {
                showError(getErrorMessage(error.code));
            }
        }
    }

    async function handleLogout() {
        await auth.signOut();
        showAuthSection();
        showSuccess('Logged out.');
    }

    function goToDashboard() {
        window.location.href = "dashboard.html";
    }

    auth.onAuthStateChanged((user) => {
        if (user) {
            showWelcomeSection(user);
        } else {
            showAuthSection();
        }
    });

    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            if (document.getElementById('signinForm').classList.contains('active')) {
                handleLogin();
            } else {
                handleRegister();
            }
        }
    });
    </script>
</body>
<link rel="stylesheet" href="y2k-style.css">
</html>
